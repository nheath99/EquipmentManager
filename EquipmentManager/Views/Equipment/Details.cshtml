@model EquipmentManager.Models.EquipmentViewModel

@{
    ViewBag.Title = "Details";
}

@section scripts {
    @Scripts.Render("~/bundles/jqueryui")
    <script type="text/javascript">

        $(function () {

            $('[data-toggle="tooltip"]').tooltip();
            setExistingPart();

            $('#addTopLevelModule').click(function () {
                var eqId = $('#Id').val();

                var result = prompt("Add top level module:", "");
                if (result != null && result != "") {
                    $.ajax({
                        type: 'post',
                        url: '/Equipment/AddModule',
                        data: { equipmentId: eqId, name: result.trim(), description: "" },
                        dataType: 'json',
                        success: function (data) {
                            location.reload();
                        }
                    });
                }
            });

            $('#modalAddInstallation').click(function () {
                var eqId = $('#Id').val();
                var siteId = $('#Sites').val();
                var name = $('#addInstallationName').val();
                var desc = $('#addInstallationDescription').val();
                var importModules = document.getElementById('addInstallationImportModules').checked;
                                
                $.ajax({
                    type: 'POST',
                    url: '/Installations/AddInstallation',
                    data: { equipmentId: eqId, siteId: siteId, name: name, description: desc, importModules: importModules },
                    dataType: 'json',
                    success: function (data) {
                        location.reload();
                    },
                    error: function (a, b, c) {
                        alert(a);
                        alert(b);
                        alert(c);
                    }
                });
            });

            $('#modulesList').on('click', '[data-function]', function (event) {
                event.stopPropagation();
                var f = $(this).data('function');
                if (f == "addLabour") {
                    var root = $(this).closest('[data-module-id]');
                    var moduleId = root.data('module-id');
                    var moduleName = root.data('module-name');
                    $('#addLabour').modal('show');
                    $('#AddLabourModuleId').val(moduleId);
                    $('#addLabourModalTitle').html("Add Labour to " + moduleName);
                }
                else if (f == "removeLabour") {
                    var result = confirm("Are you sure you want to delete this labour?");
                    if (result == true) {
                        var row = $(this).closest('tr');
                        var labourId = $(this).data('labour-id');
                        $.ajax({
                            type: 'post',
                            url: '/Equipment/RemoveLabour',
                            data: { labourId: labourId },
                            dataType: 'json',
                            success: function (data) {
                                if (data.result == true) {
                                    row.remove();
                                }
                            }
                        });
                    }
                }
                else if (f == "addPart") {
                    var root = $(this).closest('[data-module-id]');
                    var moduleId = root.data('module-id');
                    var moduleName = root.data('module-name');
                    $('#addPart').modal('show');
                    $('#addPartModuleId').val(moduleId);
                }
                else if (f == "movePart") {
                    var row = $(this).closest('tr');
                    var equipmentPartId = $(this).data('equipment-part-id');
                    $.ajax({
                        type: 'post',
                        url: '/Equipment/MoveEquipmentPart',
                        data: { equipmentPartId: equipmentPartId },
                        dataType: 'json',
                        success: function (data) {
                            if (data.result == true) {
                                row.remove();

                                var newModule = $('[data-module-id=' + data.newModuleId + ']');
                                var newTable = newModule.find('[parts]').find('tbody');

                                newTable.append(row);
                            }
                        }
                    });
                }
                else if (f == "removePart") {
                    var result = confirm("Are you sure you want to delete this part?");
                    if (result == true) {
                        var row = $(this).closest('tr');
                        var equipmentPartId = $(this).data('equipment-part-id');
                        $.ajax({
                            type: 'post',
                            url: '/Equipment/RemoveEquipmentPart',
                            data: { equipmentPartId: equipmentPartId },
                            dataType: 'json',
                            success: function (data) {
                                if (data.result == true) {
                                    row.remove();
                                }
                            },
                            error: function (a, b, c) {
                                alert(a);
                                alert(b);
                                alert(c);
                            }
                        });
                    }
                }
                else if (f == "addChildModule") {
                    var parentModule = $(this).closest('[data-module-id]');
                    var parentModuleName = parentModule.data('module-name');
                    var result = prompt("Add child module to " + parentModuleName + ":", "");
                    if (result != null && result != "") {
                        var parentModuleId = parentModule.data('module-id');
                        var eqId = $('#Id').val();
                        $.ajax({
                            type: 'post',
                            url: '/Equipment/AddModule',
                            data: { equipmentId: eqId, name: result, description: "", parentModuleId: parentModuleId },
                            dataType: 'json',
                            success: function (data) {
                                if (data.result == true) {
                                    location.reload();
                                }
                            }
                        })
                    }
                }
                else if (f == "removeChildModule") {
                    var module = $(this).closest('[data-module-id]');
                    var row = $(this).closest('li');
                    var moduleName = module.data('module-name');
                    var result = confirm("Are you sure you want to delete " + moduleName + " and all Parts and Labour?");
                    if (result == true) {
                        var moduleId = module.data('module-id');
                        $.ajax({
                            type: 'post',
                            url: '/Equipment/RemoveModule',
                            data: { moduleId: moduleId },
                            dataType: 'json',
                            success: function (data) {
                                if (data.result == true) {
                                    row.remove();
                                }
                            },
                            error: function (a, b, c) {
                                alert(c);
                            }
                        })
                    }
                }
            });

            $('#modalAddLabour').click(function () {

                var moduleId = $('#AddLabourModuleId').val();
                var eqId = $('#Id').val();
                var name = $('#addLabourName').val();
                var description = $('#addLabourDescription').val();
                var suplierId = $('#Suppliers').val();
                var qty = $('#addLabourQuantity').val();
                var unit = $('#TemporalUnit').val();

                $.ajax({
                    type: 'post',
                    url: '/Equipment/AddLabour',
                    data: { equipmentId: eqId, moduleId: moduleId, name: name, description: description, supplierId: suplierId, quantity: qty, quantityUnit: unit },
                    dataType: 'json',
                    success: function (data) {
                        if (data.result == true) {
                            var module = $('[data-module-id=' + moduleId + ']');
                            var labourTable = module.find('[labour] > table > tbody');

                            var row = '<tr><td>' + data.name +
                                '</td><td>' + data.supplierName +
                                '</td><td>' + data.quantity +
                                '</td><td><a class="glyphicon glyphicon-tasks pointer" data-toggle="tooltip" data-placement="bottom" title="Edit" data-function="editLabour" data-labour-id="' + data.id + '"></a>' +
                                '</td></tr>';

                            $('#AddLabourModuleId').val('');
                            $('#addLabourName').val('');
                            $('#addLabourDescription').val('');
                            $('#Suppliers').val('');
                            $('#addLabourQuantity').val('');
                            $('#TemporalUnit').val('0');

                            $('#addLabour').modal('hide');

                            labourTable.append(row);
                        }
                    }
                });
            });

            $('#labourTable').on('click', '.remove-row', function () {
                var id = $(this).data('id');
                var row = $(this).closest('tr');

                $.ajax({
                    type: 'POST',
                    url: '/Equipment/RemoveLabour',
                    data: { id: id },
                    dataType: 'json',
                    success: function (data) {
                        if (data.result == true) {
                            row.remove();
                        }
                        else {
                            alert("Cannot delete.");
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                    }
                })

                row.remove();
            });

            $('#partsList').on('click', '.panel-heading', function () {
                if ($(this).data('action') == 'expand') {
                    $(this).data('action', 'collapse');
                    var x = $(this).children('.glyphicon-chevron-right');
                    expandModule(x);
                }
                else if ($(this).data('action') == 'collapse') {
                    $(this).data('action', 'expand');
                    var x = $(this).children('.glyphicon-chevron-down');
                    collapseModule(x);
                }
            });

            $('#modulesList').on('click', '[data-action]', function () {
                if ($(this).data('action') == 'expand') {
                    $(this).data('action', 'collapse');
                    var x = $(this).children('.glyphicon-chevron-right');
                    expandModule(x);
                }
                else if ($(this).data('action') == 'collapse') {
                    $(this).data('action', 'expand');
                    var x = $(this).children('.glyphicon-chevron-down');
                    collapseModule(x);
                }
            });

            function expandModule(module) {
                module.toggleClass('glyphicon-chevron-right');
                module.toggleClass('glyphicon-chevron-down');

                var row = module.closest('.panel');
                row.children('.module-children').show();
            }

            function collapseModule(module) {
                module.toggleClass('glyphicon-chevron-right');
                module.toggleClass('glyphicon-chevron-down');

                var row = module.closest('.panel');
                row.children('.module-children').hide();
            }

            $('#modalAddPart').click(function () {
                
                if ($('#addExistingPartRadio').prop('checked')) {

                    var eqId = $('#Id').val();
                    var moduleId = $('#addPartModuleId').val();
                    var itId = $('#addPartId').val();
                    var qty = $('#addPartQty').val();
                    var unit = $('#UnitsOfMeasure').val();
                    var n = $('#addPartNotes').val();

                    $.ajax({
                        type: 'POST',
                        url: '/Equipment/AddEquipmentPart',
                        data: { equipmentId: eqId, moduleId: moduleId, partId: itId, quantityRequired: qty, unitOfMeasure: unit, notes: n },
                        dataType: 'json',
                        success: function (data) {
                            var module = $('[data-module-id=' + moduleId + ']');
                            var partsTable = module.find('[parts] > table > tbody').last();

                            var row = '<tr><td>' + data.name +
                                '</td><td>' + data.manufacturer +
                                '</td><td>' + data.supplier +
                                '</td><td>' + data.quantityRequired +
                                '</td><td><a class="glyphicon glyphicon-chevron-left pointer" data-toggle="tooltip" data-placement="bottom" title="Move to parent module" data-function="movePart" data-equipment-part-id="' + data.id + '"></a>' +
                                ' <a class="glyphicon glyphicon-tasks pointer" data-toggle="tooltip" data-placement="bottom" title="Edit" data-function="editPart" data-equipment-part-id="' + data.id + '"></a>' +
                                ' <a class="glyphicon glyphicon-remove pointer" data-toggle="tooltip" data-placement="bottom" title="Remove" data-function="removePart" data-equipment-part-id="' + data.id + '"></a>' +
                                '</td></tr>';

                            partsTable.append(row);
                            $('#addPart').modal('hide');
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert(errorThrown);
                        }
                    });
                    resetAddPartModal();
                }
                else {
                    var eqId = $('#Id').val();
                    var moduleId = $('#addPartModuleId').val();

                    var name = $('#addPartNameInput').val();
                    var description = $('#addPartDescriptionInput').val();
                    var categoryId = $('#categoriesAddNew').val();
                    var manufacturerId = $('#manufacturersAddNew').val();
                    var supplierId = $('#suppliersAddNew').val();
                    var link = $('#linkAddNew').val();
                    var itemsPerUnit = $('#itemsPerUnitAddNew').val();
                    var partValues = [];
                    var partDescriptions = [];
                    $('[name="partNumberValues"]').each(function (i, element) {
                        partValues[i] = $(element).val();
                    });
                    $('[name="partNumberDescriptions"]').each(function (i, element) {
                        partDescriptions[i] = $(element).val();
                    })

                    var qty = $('#addPartQty').val();
                    var unit = $('#UnitsOfMeasure').val();
                    var n = $('#addPartNotes').val();
                    
                    if (name != "" && itemsPerUnit != "" && qty != "") {
                        $.ajax({
                            type: 'post',
                            url: '/Equipment/AddNewEquipmentPart',
                            data: {
                                name: name,
                                description: description,
                                manufacturerId: manufacturerId,
                                supplierId: supplierId,
                                categoryId: categoryId,
                                link: link,
                                partNumberValues: partValues,
                                partNumberDescriptions: partDescriptions,
                                itemsPerUnit: itemsPerUnit,
                                equipmentId: eqId,
                                moduleId: moduleId,
                                quantityRequired: qty,
                                unitOfMeasure: unit,
                                notes: n
                            },
                            dataType: 'json',
                            success: function (data) {
                                var module = $('[data-module-id=' + moduleId + ']');
                                var partsTable = module.find('[parts] > table > tbody').last();

                                var row = '<tr><td>' + data.name +
                                    '</td><td>' + data.manufacturer +
                                    '</td><td>' + data.supplier +
                                    '</td><td>' + data.quantityRequired +
                                    '</td><td><a class="glyphicon glyphicon-chevron-left pointer" data-toggle="tooltip" data-placement="bottom" title="Move to parent module" data-function="movePart" data-equipment-part-id="' + data.id + '"></a>' +
                                    ' <a class="glyphicon glyphicon-tasks pointer" data-toggle="tooltip" data-placement="bottom" title="Edit" data-function="editPart" data-equipment-part-id="' + data.id + '"></a>' +
                                    ' <a class="glyphicon glyphicon-remove pointer" data-toggle="tooltip" data-placement="bottom" title="Remove" data-function="removePart" data-equipment-part-id="' + data.id + '"></a>' +
                                    '</td></tr>';

                                partsTable.append(row);
                                $('#addPart').modal('hide');
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert(errorThrown);
                            }
                        });
                        resetAddPartModal();
                    }
                }
            });

            $("#tbItemSearch").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/Parts/Search',
                        dataType: 'json',
                        data: {
                            q: request.term
                        },
                        success: function (data) {
                            response(data);
                        }
                    });
                },
                minLength: 3,
                change: function (event, ui) {

                },
                select: function (event, ui) {
                    if (ui.item) {
                        $('#addPartId').val(ui.item.value);
                        $('#addPartName').html(ui.item.name);
                        $('#addPartDescription').html(ui.item.description);
                        $('#addPartCategory').html(ui.item.category);
                        $('#addPartManufacturer').html(ui.item.manufacturer);
                        $('#addPartSupplier').html(ui.item.supplier);
                        $('#addPartLink').html(ui.item.link);
                        $('#addPartPartNumbers').html(ui.item.partNumbers);
                        $('#addPartItemsPerUnit').html(ui.item.itemsPerUnit);
                        $('#addPartQty').val('1');
                        $('#UnitsOfMeasure').get(0).selectedIndex = 0;
                        $('#addPartNotes').val('');
                        $('#modalAddPart').prop('disabled', false);
                    }
                    else {
                        alert('Error');
                        resetAddPartModal();
                    }
                    $(this).val(ui.item.label);
                    return false;
                },
                open: function () {
                    $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
                },
                close: function () {
                    $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
                }
            });
            $('#modalAddPartCancel').click(function () {
                resetAddPartModal();
            });

            function resetAddPartModal() {
                $('#addPartId').val('');
                $('#addPartModuleId').val('');
                $('#tbItemSearch').val('');
                $('#addPartName').html('');
                $('#addPartDescription').html('');
                $('#addPartCategory').html('');
                $('#addPartManufacturer').html('');
                $('#addPartSupplier').html('');
                $('#addPartLink').html('');
                $('#addPartPartNumbers').html('');
                $('#addPartItemsPerUnit').html('');
                $('#addPartQty').val('1');
                $('#UnitsOfMeasure').get(0).selectedIndex = 0;
                $('#addPartNotes').val('');

                $('#addPartNameInput').val('');
                $('#addPartDescriptionInput').val('');
                $('#categoriesAddNew').get(0).selectedIndex = 0;
                $('#manufacturersAddNew').get(0).selectedIndex = 0;
                $('#suppliersAddNew').get(0).selectedIndex = 0;
                $('#linkAddNew').val('');
                $('#itemsPerUnitAddNew').val('1');
                $('#partNumbersNew').find('li').remove();

                if ($('#addExistingPartRadio').prop('checked')) {
                    $('#modalAddPart').prop('disabled', true);
                }                
            }

            function setExistingPart() {
                $('#addPartSearchDiv').show();

                $('#addPartName').show();
                $('#addPartDescription').show();
                $('#addPartCategory').show();
                $('#addPartManufacturer').show();
                $('#addPartSupplier').show();
                $('#addPartLink').show();
                $('#addPartItemsPerUnit').show();
                $('#addPartPartNumbers').show();

                $('#addPartNameInput').hide();
                $('#addPartDescriptionInput').hide();
                $('#categoriesAddNew').hide();
                $('#manufacturersAddNew').hide();
                $('#suppliersAddNew').hide();
                $('#linkAddNew').hide();
                $('#itemsPerUnitAddNew').hide();
                $('#partNumbersNew').hide();
            }

            function setNewPart() {
                $('#addPartSearchDiv').hide();

                $('#addPartName').hide();
                $('#addPartDescription').hide();
                $('#addPartCategory').hide();
                $('#addPartManufacturer').hide();
                $('#addPartSupplier').hide();
                $('#addPartLink').hide();
                $('#addPartItemsPerUnit').hide();
                $('#addPartPartNumbers').hide();

                $('#addPartNameInput').show();
                $('#addPartDescriptionInput').show();
                $('#categoriesAddNew').show();
                $('#manufacturersAddNew').show();
                $('#suppliersAddNew').show();
                $('#linkAddNew').show();
                $('#itemsPerUnitAddNew').show();
                $('#partNumbersNew').show();

                $('#modalAddPart').prop('disabled', false);
            }

            $('input[name="newPartType"]:radio').change(function () {
                if ($('#addExistingPartRadio').prop('checked')) {
                    setExistingPart();
                }
                else {
                    setNewPart();
                }
            });

            $('#partNumbersNewList').on('click', 'a.remove-row', function () {
                var row = $(this).closest('li');
                row.remove();
            });

            $('#partNumbersNewAdd').click(function () {
                var value = $('#partNumbersNewValue').val();
                var description = $('#partNumbersNewDescription').val();
                if (value != null && value != "") {
                    var row = '<li><a class="glyphicon glyphicon-remove remove-row" /> ' + value + '<input type="hidden" value="' + value + '" name="partNumberValues" /><input type="hidden" value="' + description + '" name="partNumberDescriptions" /></li>';
                    $('#partNumbersNewList').append(row);

                    $('#partNumbersNewValue').val('');
                    $('#partNumbersNewDescription').val('');
                }
            });
        });
    </script>
}

<div class="modal" id="addInstallationModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Select Site</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Site</label>
                        <div class="col-sm-8">
                            @Html.DropDownList("Sites", null, htmlAttributes: new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Installation Name</label>
                        <div class="col-sm-8">
                            <input type="text" id="addInstallationName" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Description</label>
                        <div class="col-sm-8">
                            <input type="text" id="addInstallationDescription" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="addInstallationImportModules" class="col-sm-4 control-label">Import Modules</label>
                        <div class="col-sm-8 checkbox">
                            <input type="checkbox" id="addInstallationImportModules" />
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button id="modalAddInstallation" type="button" class="btn btn-primary">Add Item</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="addLabour" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addLabourModalTitle">Add Labour</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal">
                    <input type="hidden" id="AddLabourModuleId" />
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Name</label>
                        <div class="col-sm-8">
                            <input type="text" id="addLabourName" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Description</label>
                        <div class="col-sm-8">
                            <input type="text" id="addLabourDescription" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Supplier</label>
                        <div class="col-sm-8">
                            @Html.DropDownList("Suppliers", null, "Select...", new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Quantity</label>
                        <div class="col-sm-8">
                            <input type="text" id="addLabourQuantity" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Unit</label>
                        <div class="col-sm-8">
                            @Html.DropDownList("TemporalUnit", null, new { @class = "form-control" })
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button id="modalAddLabour" type="button" class="btn btn-primary">Add Labour</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="addPart" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">
                    Enter Details
                </h4>
                <label class="radio-inline">
                    <input type="radio" name="newPartType" value="Existing" checked="checked" id="addExistingPartRadio" />
                    Existing Part
                </label>
                <label class="radio-inline">
                    <input type="radio" name="newPartType" value="New" />
                    New Part
                </label>

            </div>
            <div class="modal-body">
                <input type="hidden" id="addPartId" />
                <input type="hidden" id="addPartModuleId" />
                <form class="form-horizontal">
                    <div id="addPartSearchDiv" class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Select Part</label>
                        <div class="col-sm-8">
                            <input type="text" id="tbItemSearch" class="form-control" placeholder="Search..." style="width:700px;" />
                            <a href="#" class="btn btn-default btn-xs">Advanced Search</a>
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Part Name</label>
                        <div class="col-sm-8">
                            <p id="addPartName" class="form-control-static"></p>
                            <input type="text" id="addPartNameInput" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Description</label>
                        <div class="col-sm-8">
                            <p id="addPartDescription" class="form-control-static"></p>
                            <input type="text" id="addPartDescriptionInput" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Category</label>
                        <div class="col-sm-8">
                            <p id="addPartCategory" class="form-control-static"></p>
                            @Html.DropDownList("Categories", null, "Select...", new { id = "categoriesAddNew", @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Manufacturer</label>
                        <div class="col-sm-8">
                            <p id="addPartManufacturer" class="form-control-static"></p>
                            @Html.DropDownList("Manufacturers", null, "Select...", new { id = "manufacturersAddNew", @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Supplier</label>
                        <div class="col-sm-8">
                            <p id="addPartSupplier" class="form-control-static"></p>
                            @Html.DropDownList("Suppliers", null, "Select...", new { id = "suppliersAddNew", @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Link</label>
                        <div class="col-sm-8">
                            <p id="addPartLink" class="form-control-static"></p>
                            <input type="text" id="linkAddNew" class="form-control" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Part Numbers</label>
                        <div class="col-sm-8">
                            <p id="addPartPartNumbers" class="form-control-static"></p>
                            <div id="partNumbersNew">
                                <ul class="list-unstyled" id="partNumbersNewList"></ul>
                                <input type="text" id="partNumbersNewValue" class="form-control" placeholder="Value..." />
                                <input type="text" id="partNumbersNewDescription" class="form-control" placeholder="Description" />
                                <a class="btn btn-xs btn-info" id="partNumbersNewAdd">Add Part Number</a>
                            </div>
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Items per Unit</label>
                        <div class="col-sm-8">
                            <p id="addPartItemsPerUnit" class="form-control-static"></p>
                            <input type="number" id="itemsPerUnitAddNew" class="form-control" value="1" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Quantity Required</label>
                        <div class="col-sm-8">
                            <input type="text" id="addPartQty" class="form-control" value="1" />
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Unit</label>
                        <div class="col-sm-8">
                            @Html.DropDownList("UnitsOfMeasure", null, htmlAttributes: new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group form-group-sm form-group-condensed">
                        <label for="" class="col-sm-4 control-label">Notes</label>
                        <div class="col-sm-8">
                            <input type="text" id="addPartNotes" class="form-control" />
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="modalAddPartCancel" type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button id="modalAddPart" type="button" class="btn btn-primary" disabled>Add Part</button>
            </div>
        </div>
    </div>
</div>

<ol class="breadcrumb">
    <li>@Html.ActionLink("Home", "Index", "Home")</li>
    <li>@Html.ActionLink("Equipment", "Index", "Equipment")</li>
    <li class="active">@Model.Name</li>
</ol>

<h2>@Model.Name</h2>
<h4>@Model.Description</h4>
<p>
    @Html.ActionLink("Edit", "Edit", new { id = Model.Id })
</p>

@Html.HiddenFor(model => model.Id)

<fieldset>
    <legend>Installations <button id="addInstallation" class="btn btn-info btn-xs" data-toggle="modal" data-target="#addInstallationModal">Add Installation</button></legend>
    <div id="installations">
        <ul class="list-unstyled" style="margin-left:25px;">
            @foreach (var item in Model.Installations)
            {
                <li>
                    @Html.ActionLink(item.Name, "Details", "Installations", new { id = item.Id }, null)
                </li>
            }
        </ul>
    </div>
</fieldset>

<fieldset>
    <legend>Equipment Modules <button id="addTopLevelModule" class="btn btn-info btn-xs">Add Module</button></legend>
    <ul id="modulesList" class="list-unstyled">
        @foreach (var module in Model.CurrentTopLevelModules)
        {
            @Html.Partial("_EquipmentModulePartial", module)
        }
    </ul>


    <div id="partsList" class="panel panel-default panel-small">
        <div class="panel-heading" style="cursor:pointer;" data-action="expand">
            <span class="glyphicon glyphicon-chevron-right row-command"></span>
            <span class="h4">All Parts Grouped</span>
        </div>
        <table class="table table-condensed table-hover table-bordered module-children">
            <thead>
                <tr>
                    <th>Lines</th>
                    <th>Part</th>
                    <th>Manufacturer</th>
                    <th>Modules</th>
                    <th>Qty</th>
                    <th>Unit</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.AllPartsCombined)
                {
                    <tr>
                        @if (item.Lines > 1)
                        {
                            <td class="bg-danger">@item.Lines</td>
                        }
                        else
                        {
                            <td>@item.Lines</td>
                        }
                        <td>@Html.ActionLink(item.Part.Name, "Details", "Parts", new { id = item.PartId }, null)</td>
                        <td>@item.Part.ManufacturerName</td>
                        <td>
                            @foreach (var module in item.EquipmentModules)
                            {
                                @Html.ActionLink(module.Name, "Details", "EquipmentModules", new { id = module.Id }, null)
                            }
                        </td>
                        <td>@item.QuantityRequired</td>
                        <td>@item.UnitOfMeasure</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</fieldset>